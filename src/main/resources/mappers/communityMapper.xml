<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jjeopjjeop.recipe.dao.CommunityDAO">
    <select id="count" resultType="int">
        SELECT count(*) FROM communityboard
    </select>

    <select id="list" parameterType="PagenationDTO" resultType="CommunityDTO">
        SELECT * FROM (select t1.*,row_number() over (order by id DESC) as seqnum
        from CommunityBoard t1) t1
        where seqnum between #{startPage} and #{endPage}
    </select>

    <insert id="insert" parameterType="CommunityDTO">
        Insert into CommunityBoard
        values(CommunityBoard_SEQ.nextval,'jenn',0,#{category,jdbcType=VARCHAR},#{title,jdbcType=VARCHAR},#{content,jdbcType=VARCHAR},sysdate,sysdate,0,0,0)
        <selectKey resultType="int" keyProperty="id" order="AFTER">
            SELECT CommunityBoard_SEQ.CURRVAL FROM DUAL
        </selectKey>
    </insert>

    <select id="findPostById" parameterType="int" resultType="CommunityDTO">
        select * from CommunityBoard where id=#{id}
    </select>

    <insert id="storeImage" parameterType="ImageDTO">
        Insert into Image
        values(Image_SEQ.nextval,#{filename},#{board_id})
    </insert>

    <select id="findImageByPostId" parameterType="int" resultType="ImageDTO">
        select * from Image where board_id=#{id}
    </select>

</mapper>