<?xml version="1.0" encoding="UTF-8"?>
<!-- https://mybatis.org/mybatis-3/configuration.html#mappers에서 세줄만 복붙 -->
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jjeopjjeop.recipe.dao.ReviewDAO">
<!--    <select id="reviewList" parameterType="String" resultType="com.jjeopjjeop.recipe.dto.ReviewDTO">-->
<!--        SELECT * FROM produce_review WHERE produce_name = #{produce_name}-->
<!--    </select>-->

    <select id="reviewList" parameterType="int" resultType="com.jjeopjjeop.recipe.dto.ReviewDTO">
        SELECT produce_review.pay_num, produce_review.rating, produce_review.content, produce_review.created_date
        FROM produce_review, pay_history
        WHERE produce_review.pay_num = pay_history.pay_num
        AND pay_history.produce_num = #{produce_num}
    </select>

    <delete id="reviewDelete" parameterType="int">
        DELETE FROM produce_review WHERE pay_num = #{pay_num}
    </delete>

    <insert id="reviewWrite" parameterType="com.jjeopjjeop.recipe.dto.ReviewDTO">
        INSERT INTO produce_review
        VALUES(#{pay_num}, #{rating}, #{content}, sysdate)
    </insert>

<!--구매한 항목 중 리뷰를 했으면 1 리뷰 안했으면 0이 출력됨.-->
    <select id="reviewCheck" parameterType="int" resultType="int">
        SELECT count(*)
        FROM pay_history, produce_review
        WHERE pay_history.pay_num = produce_review.pay_num
        AND pay_history.pay_num= #{pay_num}
    </select>

</mapper>