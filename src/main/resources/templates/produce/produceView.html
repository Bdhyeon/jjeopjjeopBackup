<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!--임의 추가 시작-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!--임의 추가 끝-->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <th:block th:replace="fragments/head :: links"> </th:block>
    <link href="/static/css/produce.css" th:href="@{/css/produce.css}" rel="stylesheet"/>
    <script type="text/javascript" th:inline="javascript">
        $(document).ready(function() {
        //+, -버튼
        var sitePlusMinus = function() {
            $('.js-btn-minus').on('click', function(e){
                e.preventDefault();
                if ( $(this).closest('.input-group').find('.form-control').val() != 0  ) {
                    $(this).closest('.input-group').find('.form-control').val(parseInt($(this).closest('.input-group').find('.form-control').val()) - 1);
                } else {
                    $(this).closest('.input-group').find('.form-control').val(parseInt(0));
                }
            });
            $('.js-btn-plus').on('click', function(e){
                e.preventDefault();
                $(this).closest('.input-group').find('.form-control').val(parseInt($(this).closest('.input-group').find('.form-control').val()) + 1);
            });
        };
        sitePlusMinus();
        });
    </script>
</head>
<body>
<nav th:replace="fragments/nav :: front-nav('shopping')"></nav>
<div class="site-wrap">
    <div class="bg-light py-3">
        <div class="container">
            <div class="row">
                <div class="col-md-12 mb-0">
                    <th:block th:if="${beforeAddress} ==null">
                        <a th:href="@{/produce/list/0}">목록</a>
                    </th:block>
                    <th:block th:unless="${beforeAddress} ==null">
                        <a th:href="${beforeAddress}">목록</a>
                    </th:block>
                    <span class="mx-2 mb-0">/</span>
                    <strong class="text-black" th:text="${produceDTO.produce_name}">상품명</strong></div>
            </div>
        </div>
    </div>

    <div class="site-section">
        <div class="container">
            <!-- ===========================상품소개 시작=======================================-->
             <div class="row">
                <div class="col-md-6"><!--왼쪽 6칸은 상품이미지-->
                    <th:block th:if="${#strings.isEmpty(produceDTO.produce_image)}">
                        <img class="img-fluid" src="\media\images\rcp_mainimg.png" alt="대체이미지" />
                    </th:block>
                    <th:block th:unless="${#strings.isEmpty(produceDTO.produce_image)}">
                        <img class="img-fluid" th:src="${produceDTO.produce_image_path}" alt="상품이미지" />
                    </th:block>
                </div>
                <div class="col-md-6"><!--오른쪽 6칸은 기타 상품설명 등-->
                    <div>
<!--                        <input th:value="${session.user_id}">&lt;!&ndash;누가 로그인했는지 알수있게. 나중에 지우기.&ndash;&gt;-->
                        <!--로그인한 사람이 글 쓴 사람일 때만 삭제, 수정링크 보이게-->
                        <th:block th:if="${session.user_id == produceDTO.user_id}">
                            <a th:href="@{/produce/update/{produce_num}(produce_num=${produceNum})}">수정  </a>
                            <a th:href="@{/produce/update/endOfSale/{produce_num}(produce_num=${produceNum})}">판매중지</a>
                        </th:block>
                    </div>
                    <h2 class="text-dark" th:text="${produceDTO.produce_name}" style="display: inline-block">상품명</h2>
                    <th:block th:unless="${#lists.isEmpty(list)}">
                         &nbsp&nbsp<span class="text-dark h5" th:text="'리뷰평점: '+ ${#numbers.formatDecimal(#aggregates.sum(list.![rating])*1.0 / #lists.size(list), 1, 1)} + '점'"> </span>
                    </th:block>
                    <p th:text="'['+${businessName}+']'">seller_name</p>
                    <span><strong class="text-dark h4" data-th-text="${#numbers.formatInteger(produceDTO.price, 3, 'COMMA') + '원'}">상품가격</strong></span>
                    <p th:text="${produceDTO.produce_description}">상품설명</p>

                    <form name="cartWrite" id="cartWrite" method="post">
<!--                        th:action="@{/cart/write/}"-->
                        <div class="mb-5">
                            <div class="input-group mb-3" style="max-width: 120px;">
                                <div class="input-group-prepend">
                                    <button class="btn btn-outline-warning js-btn-minus" type="button">&minus;</button>
                                </div>
                                <input type="text" class="form-control text-center" value="1"
                                   aria-label="Example text with button addon" aria-describedby="button-addon1"
                                    name="quantity">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-warning js-btn-plus" type="button">&plus;</button>
                                </div>
                            </div>
                        </div>
                        <!--장바구니 넣을 때 user_id도 같이 넣어주기-->
                        <input type="hidden" th:value="${session.user_id}" name="user_id">
                        <!-- 장바구니넣을때 produce_num을 넣어주기위해-->
                        <input type="hidden" th:value="${produceDTO.produce_num}" name="produce_num" placeholder="게시글번호" />

                        <button class="btn btn-lg btn-warning" onclick="javascript: form.action='/cart/write/';">장바구니</button>
                        <br /><br />
                        <button class="btn btn-lg btn-warning" onclick="javascript: form.action='/kakaoPayDirect';">카카오페이로 결제하기</button>
                    </form>
                </div>
            </div>
            <!-- ===========================상품소개 끝=======================================-->
            <!-- ===========================리뷰 시작=======================================-->
<!--            <form name="reviewList" method="post" th:action="@{/produce/view/test/{produceNum}(produceNum=${produceDTO.produce_num})}">-->
<!--                <input type="text" th:value="${produceDTO.produce_num}" name="produce_num" />-->
<!--                <button>리뷰보기</button>-->
<!--            </form>-->

            <!--    <a th:href="@{/produce/view/test/{produceName}(produceName=${produceDTO.produce_name})}">-->
            <!--        <button>리뷰보기</button>-->
            <!--    </a>-->

            <!--    <form name="update" id="update" method="post" th:action="@{/produce/update/{produceNum}(produceNum=${produceDTO.produce_num})}">-->
            <!--인코딩방식때문에 get으로 하니까 안됨. post로 하기. href로 하면-->
            <br /><br />
            <h2>구매자 리뷰</h2> <br />

            <th:block th:if="${#lists.isEmpty(list)}">
                <h5>등록된 리뷰가 없습니다.</h5>
            </th:block>
            <th:block th:unless="${#lists.isEmpty(list)}">
                <table class="table">
                    <thead class="table-warning">
                    <tr>
                        <th scope="col">일련번호</th>
                        <th scope="col">점수</th>
                        <th scope="col">리뷰작성날짜</th>
                        <th scope="col">내용</th>
                    </tr>
                    </thead>
                    <tbody>
                        <tr th:each="reviewDTO : ${list}">
                            <td th:text="${reviewDTOStat.count}"></td><!--변수명Stat.count는 1부터 시작하는 일련번호-->
                            <td><th:block th:text="${reviewDTO.rating} +'점'" /></td>
                            <td><th:block th:text="${reviewDTO.created_date}" /></td>
                            <td><th:block th:text="${reviewDTO.content}"/></td>
                        </tr>
                    </tbody>
                </table>
            </th:block>
            <br><br><br>
            <!--=======================================리뷰 끝=============================================== -->
        </div>
    </div>
</div>

<!--임의 추가 시작-->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
<!--임의 추가 끝-->
</body>
</html>